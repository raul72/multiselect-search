/*! Multiselect Search - v0.0.1 - 2012-07-20
* https://github.com/raul72/multiselect-search
* Copyright (c) 2012 raul; Licensed MIT, GPL */
(function(){function e(a,d){return b!==a&&(c=new RegExp(a,"i"),b=a),!!d.match(c)}function f(a,b){b.parentNode.insertBefore(a,b.nextSibling)}function g(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent&&a.attachEvent("on"+b,function(){c.call(a,window.event)})}function h(b,c){if(!b||!b.className)return;var d=(b.className||"").split(a),e=[],f;for(f=0;f<d.length;f++)d[f]!==c&&e.push(d[f]);b.className=e.join(" ")}function i(a){var b,c,d,e=[];c=a.childNodes;for(b in c)c[b].nodeName&&(d=c[b].nodeName.toString().toLowerCase(),d==="option"?e[e.length]=c[b]:d==="optgroup"&&(e=e.concat(i(c[b]))));return e}function j(a,b){function g(a){if(!f)return;var b,c,d,g=f.o_node.selected;a.uid<f.uid?(b=a.uid,c=f.uid):(b=f.uid,c=a.uid);if(b!==c)for(d=b;d<=c;d++)e[d].visible&&e[d].changeState(g,!1)}function j(a,c){var d=document.createElement("div"),e={uid:c,text:a.innerHTML,o_node:a,n_node:d,visible:!0,show:function(){d.style.display="block"},hide:function(){d.style.display="none"}};return e.changeState=function(c,e){c=c!==!1,e=e!==!1,c?(a.selected=!0,d.className=d.className+" "+b.selected_option_class):(h(d,b.selected_option_class),a.selected=!1),e&&b.onchange&&b.onchange()},d.innerHTML=e.text,d.unselectable="on",d.className=b.option_class+(a.selected?" "+b.selected_option_class:""),d.onclick=function(c){c=c||window.event,a.selected?e.changeState(!1,!1):e.changeState(!0,!1),f&&(h(f.n_node,"active"),c.shiftKey&&g(e)),f=e,d.className=d.className+" active",b.onchange&&b.onchange()},e}var c,d=i(a),e=[],f;for(c in d)d.hasOwnProperty(c)&&(e[e.length]=j(d[c],e.length));return e}function k(a,b){var c,d={};for(c in a)a.hasOwnProperty(c)&&(typeof b[c]=="undefined"?d[c]=a[c]:d[c]=b[c]);return d}var a=/\s+/,b,c,d;window.multiselect_search_defaults=function(a){d=k(d,a)},d={match:e,searchbox_class:null,container_id:null,container_class:null,onchange:null,inherit_size:!0,searchbox_inherit_size:!1,searchbox:null,delay:200,select_class:"mss",option_class:"mss_option",selected_option_class:"selected"},window.multiselect_search=function(a,b){function p(){var a=[],b;for(b in c)c.hasOwnProperty(b)&&c[b].o_node.selected&&(a[a.length]={text:c[b].text,changeState:c[b].changeState});return a}function q(a){clearTimeout(o),o=setTimeout(function(){r(a)},b.delay)}function r(a,d){a=a||"",d=d===!0;var e,f;if(a===l&&!d)return;l=a;for(e in c)if(c.hasOwnProperty(e)){f=b.match.call(n,a,c[e].text);if(f===-1)continue;!a||f?(c[e].visible||c[e].show(),c[e].visible=!0):c[e].visible&&(c[e].hide(),c[e].visible=!1)}i.scrollTop=0}if(!a||!a.nodeName||a.nodeName.toString().toLowerCase()!=="select"||!a.multiple)return!1;b=k(d,b||{});var c=j(a,b),e,h,i,l="",m,n={},o;if(!c.length)return;e=document.createElement("div"),b.container_id&&(e.id=b.container_id),b.container_class&&(e.className=b.container_class),b.searchbox?h=b.searchbox:(h=document.createElement("input"),h.type="text",b.searchbox_class&&(h.className=b.searchbox_class),e.appendChild(h),e.appendChild(document.createElement("br"))),g(h,"keyup",function(){q(h.value)}),g(h,"paste",function(){q(h.value)}),i=document.createElement("div"),b.inherit_size&&(i.style.width=parseInt(a.offsetWidth,10)+"px",i.style.height=parseInt(a.offsetHeight,10)+"px"),b.searchbox_inherit_size&&(h.style.width=parseInt(a.offsetWidth,10)+"px"),b.select_class&&(i.className=b.select_class);for(m in c)c.hasOwnProperty(m)&&i.appendChild(c[m].n_node);return e.appendChild(i),a.style.display="none",f(e,a),n.get_selected=p,n.get_selected_values=function(){var a=p(),b=[],c;for(c=0;c<a.length;c++)b[c]=a[c].text;return b},n.container_node=e,n.searchbox_node=h,n.select_node=i,n.search=q,n.onchange=function(a){if(typeof b.onchange!="function"){b.onchange=a;return}var c=b.onchange;b.onchange=function(){c(),a()}},n.changeState=function(a,d){var e;d=d===!0;for(e=0;e<c.length;e++)(!d||c[e].visible)&&c[e].changeState(a,!1);b.onchange&&b.onchange()},n.showSelected=function(){var a,b=[],d=[];for(a=0;a<c.length;a++)c[a].o_node.selected&&(b[b.length]=c[a].uid),c[a].visible&&(d[d.length]=c[a].uid);if(b.join()===d.join()){r(h.value,!0);return}for(a in c)c.hasOwnProperty(a)&&(c[a].o_node.selected?(c[a].visible||c[a].show(),c[a].visible=!0):c[a].visible&&(c[a].hide(),c[a].visible=!1));i.scrollTop=0},n}})();